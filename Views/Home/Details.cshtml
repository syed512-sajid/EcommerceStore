@model EcommerceStore.Models.Product

@{
    ViewData["Title"] = Model.Name;
}

<div class="container mt-4">

    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a asp-action="Index">Home</a>
            </li>
            <li class="breadcrumb-item active">@Model.Name</li>
        </ol>
    </nav>

    <div class="row">

        <!-- LEFT: IMAGES -->
        <div class="col-md-6">
            @if (Model.Images != null && Model.Images.Any())
            {
                <div class="product-image-wrapper">

                    @if (Model.ShowDiscount && Model.DiscountPercent > 0)
                    {
                        <span class="badge bg-danger discount-badge">
                            @Model.DiscountPercent% OFF
                        </span>
                    }

                    <div id="carousel-@Model.Id" class="carousel slide" data-bs-ride="carousel">
                        <div class="carousel-inner rounded">

                            @for (int i = 0; i < Model.Images.Count; i++)
                            {
                                <div class="carousel-item @(i == 0 ? "active" : "")">
                                    <div class="product-image-box">
                                        <img src="@Model.Images[i].ImageUrl"
                                     class="img-fluid product-image"
                                     alt="@Model.Name" />
                                    </div>
                                </div>
                            }

                        </div>

                        @if (Model.Images.Count > 1)
                        {
                            <!-- PREV -->
                            <button class="carousel-control-prev" type="button"
                            data-bs-target="#carousel-@Model.Id"
                            data-bs-slide="prev">
                                <i class="bi bi-chevron-left fs-2 text-white bg-dark rounded-circle p-2"></i>
                            </button>

                            <!-- NEXT -->
                            <button class="carousel-control-next" type="button"
                            data-bs-target="#carousel-@Model.Id"
                            data-bs-slide="next">
                                <i class="bi bi-chevron-right fs-2 text-white bg-dark rounded-circle p-2"></i>
                            </button>

                            <!-- Indicators -->
                            <div class="carousel-indicators">
                                @for (int i = 0; i < Model.Images.Count; i++)
                                {
                                    <button type="button"
                                data-bs-target="#carousel-@Model.Id"
                                data-bs-slide-to="@i"
                                class="@(i == 0 ? "active" : "")">
                                    </button>
                                }
                            </div>
                        }
                    </div>
                </div>
            }
            else
            {
                <div class="product-image-box rounded">
                    <img src="/images/no-image.jpg"
                     class="img-fluid product-image"
                     alt="No Image" />
                </div>
            }
        </div>

        <!-- RIGHT: PRODUCT INFO -->
        <div class="col-md-6">

            <h1 class="mb-3">@Model.Name</h1>
            <span class="badge bg-secondary">@Model.Category</span>

            <!-- Price -->
            <div class="my-3">
                <h2 class="text-primary d-inline">
                    Rs. @Model.Price.ToString("N0")
                </h2>

                @if (Model.ShowDiscount && Model.OriginalPrice.HasValue && Model.OriginalPrice > Model.Price)
                {
                    <span class="ms-3">
                        <del class="text-muted fs-5">
                            Rs. @Model.OriginalPrice.Value.ToString("N0")
                        </del>
                        <span class="badge bg-success ms-2">
                            Save Rs. @(Model.OriginalPrice.Value - Model.Price)
                        </span>
                    </span>
                }
            </div>

            <!-- Description -->
            <div class="my-4">
                <h5>Description</h5>
                <p class="lead text-muted">@Model.Description</p>
            </div>

            <!-- Stock -->
            <div class="alert @(Model.Stock > 0 ? "alert-success" : "alert-danger")">
                @if (Model.Stock > 0)
                {
                    <strong>In Stock:</strong> @Model.Stock <span>units</span>
                }
                else
                {
                    <strong>Out of Stock</strong>
                }

            </div>


            <!-- Add To Cart -->
            @if (Model.Stock > 0)
            {
                <form asp-action="AddToCart" asp-controller="Home" method="post">
                    <input type="hidden" name="productId" value="@Model.Id" />

                    <div class="mb-3">
                        <label class="form-label fw-bold">Quantity</label>
                        <input type="number"
                           name="quantity"
                           class="form-control quantity-input"
                           value="1"
                           min="1"
                           max="@Model.Stock" />
                    </div>

                    <button type="submit" class="btn btn-success btn-lg">
                        <i class="bi bi-cart-plus"></i> Add to Cart
                    </button>

                    <a asp-action="Index" class="btn btn-outline-secondary btn-lg ms-2">
                        Continue Shopping
                    </a>
                </form>
            }
            else
            {
                <button class="btn btn-secondary btn-lg" disabled>
                    Out of Stock
                </button>
            }
        </div>
    </div>

    <!-- Product Info Table -->
    <div class="row mt-5">
        <div class="col-12">
            <hr />
            <h4>Product Information</h4>

            <table class="table table-bordered mt-3">
                <tr>
                    <th>Category</th>
                    <td>@Model.Category</td>
                </tr>
                <tr>
                    <th>Price</th>
                    <td>Rs. @Model.Price.ToString("N0")</td>
                </tr>
                <tr>
                    <th>Stock</th>
                    <td>@Model.Stock units</td>
                </tr>
                <tr>
                    <th>Added On</th>
                    <td>@Model.CreatedAt.ToString("MMM dd, yyyy")</td>
                </tr>
            </table>
        </div>
    </div>

</div>

@section Scripts {
    <script src="~/js/Product.js"></script>
}
